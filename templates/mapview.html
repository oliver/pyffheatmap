<!DOCTYPE html>
<html>
<head>
<title>Map View</title>

<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />

<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

<style type="text/css">
body {
    padding: 0;
    margin: 0
}
html, body, #map {
    height: 100%;
    width: 100%;
}
</style>
</head>

<body>
<div id="map"></div>

<script type="text/javascript">

var map;
var features = null;

function reloadData(e) {
    bounds = map.getBounds();

    \$.ajax({
        url: "/mapdata/"+bounds.getWest()+"/"+bounds.getEast()+"/"+bounds.getNorth()+"/"+bounds.getSouth(),
        success: function(response)
        {
            if (features != null)
            {
                map.removeLayer(features);
            }

            features = new L.geoJson(response, {
                pointToLayer: function (feature, latlng) {
                    return new L.Marker(latlng, {title: feature.properties.text});
                }
            });
            map.addLayer(features);
        }
    });
}

\$(function() {
    map = L.map('map').setView([51.55,9.94], 17);
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {maxZoom: 18}).addTo(map);

    reloadData();
    map.on('moveend', reloadData);
});

</script>

</body>
</html>
